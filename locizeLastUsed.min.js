!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.locizeLastUsed=e()}(this,function(){"use strict";function t(t,e,n){var i;return function(){var o=this,s=arguments,r=function(){i=null,n||t.apply(o,s)},u=n&&!i;clearTimeout(i),i=setTimeout(r,e),u&&t.apply(o,s)}}function e(t,e,n){var i=t;return e.forEach(function(t){var e=new RegExp("{{"+t+"}}","g");i=i.replace(e,n[t])}),i}function n(t,e,n,i,o){try{var s=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");s.open(i?"POST":"GET",t,1),e.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&s.setRequestHeader("Authorization",e.apiKey),(i||e.setContentTypeJSON)&&s.setRequestHeader("Content-type","application/json"),s.onreadystatechange=function(){s.readyState>3&&n&&n(s.responseText,s)},s.send(JSON.stringify(i))}catch(t){window.console&&window.console.log(t)}}function i(){return{lastUsedPath:"https://api.locize.io/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:9e4,allowedHosts:["localhost"]}}var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},s={init:function(e){var n=e.t&&"function"==typeof e.t;this.options=n?o({},i(),this.options,e.options.locizeLastUsed):o({},i(),this.options,e);var s=window.location&&window.location.hostname;s&&(this.isAllowed=this.options.allowedHosts.indexOf(s)>-1),this.submitting=null,this.pending={},this.done={},this.submit=t(this.submit,this.options.debounceSubmit),n&&this.interceptI18next(e)},interceptI18next:function(t){var e=this,n=t.services.resourceStore.getResource;t.services.resourceStore.getResource=function(i,o,s,r){return s&&e.used(o,s),n.call(t.services.resourceStore,i,o,s,r)}},used:function(t,e){var n=this;["pending","done"].forEach(function(i){n.done[t]&&n.done[t][e]||(n[i][t]||(n[i][t]={}),n[i][t][e]=!0)}),this.submit()},submit:function(){var t=this;if(this.isAllowed){if(this.submitting)return this.submit();this.submitting=this.pending,this.pending={};var i=Object.keys(this.submitting),s=i.length,r=function(){--s||(t.submitting=null)};i.forEach(function(i){var s=Object.keys(t.submitting[i]),u=e(t.options.lastUsedPath,["projectId","version","lng","ns"],o({},t.options,{lng:t.options.referenceLng,ns:i}));s.length?n(u,o({authorize:!0},t.options),function(t,e){r()},s):r()})}}};return s.type="3rdParty",s});
