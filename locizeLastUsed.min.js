!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).locizeLastUsed=t()}(this,(function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function n(n){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?t(Object(o),!0).forEach((function(t){e(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}))}return n}var i={init:function(e){var t=e.t&&"function"==typeof e.t;this.options=n({},{lastUsedPath:"https://api.locize.io/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:9e4,allowedHosts:["localhost"]},{},this.options,{},t?e.options.locizeLastUsed:e);var i,o,s,r,c=window.location&&window.location.hostname;this.isAllowed=!c||this.options.allowedHosts.indexOf(c)>-1,this.submitting=null,this.pending={},this.done={},this.submit=(i=this.submit,o=this.options.debounceSubmit,function(){var e=this,t=arguments,n=function(){r=null,s||i.apply(e,t)},c=s&&!r;clearTimeout(r),r=setTimeout(n,o),c&&i.apply(e,t)}),t&&this.interceptI18next(e)},interceptI18next:function(e){var t=this,n=e.services.resourceStore.getResource;e.services.resourceStore.getResource=function(i,o,s,r){return s&&t.used(o,s),n.call(e.services.resourceStore,i,o,s,r)}},used:function(e,t){var n=this;["pending","done"].forEach((function(i){n.done[e]&&n.done[e][t]||(n[i][e]||(n[i][e]={}),n[i][e][t]=!0)})),this.submit()},submit:function(){var e=this;if(this.isAllowed){if(this.submitting)return this.submit();var t,i=(t=this.options,["projectId","version","apiKey","referenceLng"].reduce((function(e,n){if(e)return e;if(!t||!t[n]||"string"!=typeof t[n]||!t[n].toLowerCase()===n.toLowerCase()){var i='i18next-lastused :: got "'.concat(t[n],'" in options for ').concat(n," which is invalid.");return console.warn(i),i}return!1}),!1));if(i)return callback(new Error(i));this.submitting=this.pending,this.pending={};var o=Object.keys(this.submitting),s=o.length,r=function(){--s||(e.submitting=null)};o.forEach((function(t){var i,o,s,c,u=Object.keys(e.submitting[t]),a=(i=e.options.lastUsedPath,o=["projectId","version","lng","ns"],s=n({},e.options,{lng:e.options.referenceLng,ns:t}),c=i,o.forEach((function(e){var t=new RegExp("{{".concat(e,"}}"),"g");c=c.replace(t,s[e])})),c);u.length?function(e,t,n,i,o){try{var s=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");s.open(i?"POST":"GET",e,1),t.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.authorize&&t.apiKey&&s.setRequestHeader("Authorization",t.apiKey),(i||t.setContentTypeJSON)&&s.setRequestHeader("Content-type","application/json"),s.onreadystatechange=function(){s.readyState>3&&n&&n(s.responseText,s)},s.send(JSON.stringify(i))}catch(e){window.console&&window.console.log(e)}}(a,n({},{authorize:!0},{},e.options),(function(e,t){r()}),u):r()}))}},type:"3rdParty"};return i}));
