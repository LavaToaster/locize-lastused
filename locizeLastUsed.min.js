!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.locizeLastUsed=e()}(this,function(){"use strict";function t(t,e,n){var i;return function(){var o=this,s=arguments,r=function(){i=null,n||t.apply(o,s)},u=n&&!i;clearTimeout(i),i=setTimeout(r,e),u&&t.apply(o,s)}}function e(t,e,n){var i=t;return e.forEach(function(t){var e=new RegExp("{{"+t+"}}","g");i=i.replace(e,n[t])}),i}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,n,i,o){try{var s=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");s.open(i?"POST":"GET",t,1),e.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.authorize&&e.apiKey&&s.setRequestHeader("Authorization",e.apiKey),(i||e.setContentTypeJSON)&&s.setRequestHeader("Content-type","application/json"),s.onreadystatechange=function(){s.readyState>3&&n&&n(s.responseText,s)},s.send(JSON.stringify(i))}catch(t){window.console&&console.log(t)}}function o(){return{lastUsedPath:"https://api.locize.io/used/{{projectId}}/{{version}}/{{lng}}/{{ns}}",referenceLng:"en",crossDomain:!0,setContentTypeJSON:!1,version:"latest",debounceSubmit:"90000"}}var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function(){function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,u),this.init(t),this.type="3rdParty"}return r(u,[{key:"init",value:function(e){var n=e.t&&"function"==typeof e.t;this.options=n?s({},o(),this.options,e.options.locizeLastUsed):s({},o(),this.options,e),this.submitting=null,this.pending={},this.done={},this.submit=t(this.submit,this.options.debounceSubmit),n&&this.interceptI18next(i18next)}},{key:"interceptI18next",value:function(t){var e=this,n=t.services.resourceStore.getResource;t.services.resourceStore.getResource=function(i,o,s,r){return e.used(o,s),n.call(t.services.resourceStore,i,o,s,r)}}},{key:"used",value:function(t,e){var n=this;["pending","done"].forEach(function(i){n.done[t]&&n.done[t][e]||(n[i][t]||(n[i][t]={}),n[i][t][e]=!0)}),this.submit()}},{key:"submit",value:function(){var t=this;if(this.submitting)return this.submit();this.submitting=this.pending,this.pending={};var n=e(this.options.lastUsedPath,s({},this.options,{lng:this.options.referenceLng})),o=Object.keys(this.submitting),r=o.length,u=function(){--r||(t.submitting=null)};o.forEach(function(e){var o=Object.keys(t.submitting[e]);o.length?i(n,s({authorize:!0},t.options),function(t,e){u()},o):u()})}}]),u}();return u.type="3rdParty",u});
